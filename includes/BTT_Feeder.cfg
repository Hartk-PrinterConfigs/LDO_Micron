[gcode_macro HUB_STATUS]
gcode:
  {action_call_remote_method("openfeeder_hub_status")}


[gcode_macro OPENFEEDER_STATUS]
gcode:
  {action_call_remote_method("openfeeder_status")}


[gcode_macro OPENFEEDER_MOVE]
gcode:
  {% set FEEDER = params.FEEDER|default(0)|int %}
  {% set DIST   = params.DIST|default(10.0)|float %}
  {% set SPEED  = params.SPEED|default(50.0)|float %}   # mm/s (optional)

  {action_respond_info("OPENFEEDER_MOVE feeder=%d dist=%.3fmm speed=%.1fmm/s" % (FEEDER, DIST, SPEED))}
  {action_call_remote_method("openfeeder_move", feeder=FEEDER, dist_mm=DIST, speed_mms=SPEED)}


[gcode_macro OPENFEEDER_MOVE_UNTIL]
description: Move feeder by signed distance mm OR stop earlier when sensor becomes true
gcode:
  {% set FEEDER = params.FEEDER|default(0)|int %}
  {% set DIST   = params.DIST|default(100.0)|float %}
  {% set SENSOR = params.SENSOR|default("post-gear")|string %}
  {% set SPEED  = params.SPEED|default(50.0)|float %}      # mm/s
  {% set TIMEOUT = params.TIMEOUT|default(15.0)|float %}   # seconds

  {action_respond_info("OPENFEEDER_MOVE_UNTIL feeder=%d dist=%.2fmm sensor=%s speed=%.1fmm/s timeout=%.1fs" %
    (FEEDER, DIST, SENSOR, SPEED, TIMEOUT))}
  {action_call_remote_method("openfeeder_move_until",
      feeder=FEEDER,
      dist_mm=DIST,
      sensor=SENSOR,
      speed_mms=SPEED,
      timeout_s=TIMEOUT)}
