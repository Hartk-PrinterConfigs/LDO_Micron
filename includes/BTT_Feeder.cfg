[gcode_shell_command ESP_FEEDER_ENABLE]
command: bash -lc "curl -sS -X POST -H 'X-Api-Token: change-me' http://192.168.1.61/api/enable"
timeout: 5.0
verbose: True

[gcode_shell_command ESP_FEEDER_DISABLE]
command: bash -lc "curl -sS -X POST -H 'X-Api-Token: change-me' http://192.168.1.61/api/disable"
timeout: 5.0
verbose: True

[gcode_shell_command ESP_FEEDER_MOVE]
command: bash -lc 'curl -sS -X POST -H "X-Api-Token: change-me" -H "Content-Type: application/json" --data "$(printf "{\"steps\":%s,\"dir\":%s,\"rate_hz\":%s}" "$STEPS" "$DIR" "$RATE")" http://192.168.1.61/api/move'
timeout: 30.0
verbose: True

[gcode_macro FEEDER_ON]
gcode:
  RUN_SHELL_COMMAND CMD=ESP_FEEDER_ENABLE

[gcode_macro FEEDER_OFF]
gcode:
  RUN_SHELL_COMMAND CMD=ESP_FEEDER_DISABLE

[gcode_macro FEEDER_ADVANCE]
variable_steps_per_mm: 100
gcode:
  {% set mm = params.MM|default(10)|float %}
  {% set rate = params.RATE|default(12000)|int %}
  {% set steps = (mm * printer["gcode_macro FEEDER_ADVANCE"].steps_per_mm)|int %}
  RUN_SHELL_COMMAND CMD=ESP_FEEDER_ENABLE
  RUN_SHELL_COMMAND CMD=ESP_FEEDER_MOVE STEPS={steps} DIR=1 RATE={rate}

[gcode_macro FEEDER_RETRACT]
variable_steps_per_mm: 100
gcode:
  {% set mm = params.MM|default(10)|float %}
  {% set rate = params.RATE|default(12000)|int %}
  {% set steps = (mm * printer["gcode_macro FEEDER_RETRACT"].steps_per_mm)|int %}
  RUN_SHELL_COMMAND CMD=ESP_FEEDER_ENABLE
  RUN_SHELL_COMMAND CMD=ESP_FEEDER_MOVE STEPS={steps} DIR=0 RATE={rate}


